<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>

    <title>Escalapp</title>
    <link rel="icon" type="image/png" href="./Mountains Sun Icon.svg">
</head>
<body>
    <div class="flex w-screen h-screen bg-[url(https://s3.amazonaws.com/images.gearjunkie.com/uploads/2022/12/Screen-Shot-2022-12-12-at-9.35.57-AM.jpg)] bg-cover bg-center">
        <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8 bg-gray-700 bg-opacity-75 w-1/3">
            <div class="sm:mx-auto sm:w-full sm:max-w-sm">
              <img class="mx-auto h-12 w-auto" src="./Mountains Sun Icon.svg" alt="Escalapp Logo">
              <h2 class="mt-10 text-center text-3xl font-bold tracking-tight text-green-400">Log In</h2>
            </div>

            <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
              <form id="loginForm" class="space-y-6">
                <div>
                  <label for="emailOrUsername" class="block text-sm font-medium text-green-400">Email address / Username</label>
                  <div class="mt-2">
                    <input type="text" name="emailOrUsername" id="emailOrUsername" required class="block w-full rounded-md border-0 bg-gray-300/50 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-600 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6">
                  </div>
                </div>

                <div>
                  <div class="flex items-center justify-between">
                    <label for="password" class="block text-sm font-medium text-green-400">Password</label>
                    <div class="text-sm">
                      <a href="#" class="font-semibold text-green-400 hover:text-green-600">Forgot password?</a>
                    </div>
                  </div>
                  <div class="mt-2">
                    <input type="password" name="password" id="password" autocomplete="current-password" required class="block w-full rounded-md border-0 bg-gray-300/50 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-600 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6">
                  </div>
                </div>

                <div>
                  <button type="submit" class="flex w-full justify-center rounded-md bg-green-600 px-3 py-1.5 text-sm font-semibold text-black shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
                    Log in
                  </button>
                </div>
              </form>

              <p class="mt-10 text-center text-sm text-green-400">
                Don't have an account?
                <a href="./signup.html" class="font-semibold text-green-400 hover:text-green-600">Sign up here.</a>
              </p>
              <p id="message" class="mt-4 text-center text-sm text-red-500"></p>
            </div>
          </div>
          <div class="w-2/3">
              </div>
    </div>

    <script>
      const loginForm = document.getElementById('loginForm');
      const messageElement = document.getElementById('message');

      loginForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const emailOrUsernameInput = document.getElementById('emailOrUsername');
        const passwordInput = document.getElementById('password');

        const emailOrUsername = emailOrUsernameInput.value;
        const password = passwordInput.value;

        if (!emailOrUsername || !password) {
          messageElement.textContent = 'Please enter both username/email and password.';
          return;
        }

        // Create the data object
        const userData = {
          emailOrUsername: emailOrUsername, // Match backend expected key
          password: password // Match backend expected key
        };

        // --- Build the URL with query parameters for GET ---
        const backendBaseUrl = 'http://localhost:3000/login'; // <<<--- CHANGE THIS TO YOUR BACKEND BASE URL
        const queryParams = new URLSearchParams(userData).toString(); // Encode data into query string
        const backendUrlWithParams = `${backendBaseUrl}?${queryParams}`;
        // ---------------------------------------------------

        try {
          // --- Use GET method ---
          const response = await fetch(backendUrlWithParams, {
              method: 'GET'
              // No 'Content-Type' header and no 'body' for GET requests
          });
          // -----------------------

          if (response.ok) {
            const data = await response.json();
            console.log('Login successful:', data);
            messageElement.textContent = 'Login successful!';
            messageElement.style.color = 'green';

            setTimeout(() => {
                 window.location.href = 'index.html';
            }, 1000);

          } else {
            const errorData = await response.json();
            console.error('Login failed:', response.status, errorData);
            messageElement.textContent = errorData.message || 'Login failed. Please check your credentials.';
            messageElement.style.color = 'red';
          }

        } catch (error) {
          console.error('Network error during login:', error);
          messageElement.textContent = 'Could not connect to the server. Please try again later.';
          messageElement.style.color = 'red';
        }
      });
    </script>
</body>
</html>